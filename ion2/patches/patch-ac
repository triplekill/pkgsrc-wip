$NetBSD: patch-ac,v 1.1.1.1 2004/01/09 23:03:20 cube Exp $

--- ioncore/readconfig.c.orig	2003-12-06 12:44:30.000000000 +0100
+++ ioncore/readconfig.c
@@ -87,7 +87,24 @@ bool ioncore_add_scriptdir(const char *d
 
 bool ioncore_add_moduledir(const char *dir)
 {
-	return (lt_dlinsertsearchdir(lt_dlgetsearchpath(), dir)==0);
+	const char *oldpath;
+	char *newpath;
+	bool ret;
+
+	oldpath=lt_dlgetsearchpath();
+	if(oldpath==NULL){
+		return (lt_dlsetsearchpath(dir)==0);
+	}else{
+		libtu_asprintf(&newpath, "%s:%s", dir, oldpath);
+		if(newpath==NULL){
+			warn_err();
+			return FALSE;
+		}else{
+			ret=(lt_dlsetsearchpath(newpath)==0);
+			free(newpath);
+			return ret;
+		}
+	}
 }
 
 
