# $NetBSD$
#

DISTNAME=		pam_pwdfile-0.99
PKGNAME=		${DISTNAME:S/_/-/}
PKGREVISION=		2
CATEGORIES=		security
MASTER_SITES=		http://cpbotha.net/files/pam_pwdfile/

MAINTAINER=		bartosz@atom.eu.org
HOMEPAGE=		http://cpbotha.net/pam_pwdfile.html
COMMENT=		PAM module for authenticating with text password files

USE_LIBTOOL=		yes

pre-build:
	${CP} files/_pam_macros.h ${WRKSRC}

do-build:
	cd ${WRKSRC} && \
	${SHLIBTOOL} --mode=compile ${CC} -c pam_pwdfile.c -o pam_pwdfile.o && \
	${SHLIBTOOL} --mode=compile ${CC} -c bigcrypt.c -o bigcrypt.o && \
	${SHLIBTOOL} --mode=compile ${CC} -DHIGHFIRST -D'MD5Name(x)=Good##x' \
		-c md5.c -o md5_good.o && \
	${SHLIBTOOL} --mode=compile ${CC} -D'MD5Name(x)=Broken##x' \
		-c md5.c -o md5_broken.o && \
	${SHLIBTOOL} --mode=compile ${CC} -D'MD5Name(x)=Good##x' \
		-c md5_crypt.c -o md5_crypt_good.o && \
	${SHLIBTOOL} --mode=compile ${CC} -D'MD5Name(x)=Broken##x' \
		-c md5_crypt.c -o md5_crypt_broken.o && \
	${SHLIBTOOL} --mode=link ${CC} -avoid-version -module \
		-o pam_pwdfile.la -lpam -lcrypt -rpath ${PREFIX}/lib/security \
		pam_pwdfile.lo md5_good.lo md5_crypt_good.lo md5_broken.lo \
		md5_crypt_broken.lo bigcrypt.lo

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/lib/security
	${SHLIBTOOL} --mode=install ${INSTALL_PROGRAM} \
		-c ${WRKSRC}/pam_pwdfile.la ${PREFIX}/lib/security
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/pam-pwdfile
	${INSTALL_DATA} ${WRKSRC}/README ${PREFIX}/share/doc/pam-pwdfile
	${INSTALL_DATA} ${WRKSRC}/changelog ${PREFIX}/share/doc/pam-pwdfile

.include "../../mk/pam.buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
