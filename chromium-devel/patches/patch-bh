$NetBSD$

--- chrome/browser/renderer_host/backing_store_x.cc.orig	2010-07-27 09:05:53.000000000 +0000
+++ chrome/browser/renderer_host/backing_store_x.cc
@@ -10,7 +10,7 @@
 #include <sys/ipc.h>
 #include <sys/shm.h>
 
-#if defined(OS_OPENBSD) || defined(OS_FREEBSD)
+#if defined(OS_OPENBSD) || defined(OS_FREEBSD) || defined(OS_NETBSD)
 #include <sys/endian.h>
 #endif
 
@@ -57,6 +57,9 @@ static void DestroySharedImage(Display* 
   XShmDetach(display, shminfo);
   XDestroyImage(image);
   shmdt(shminfo->shmaddr);
+#if defined(OS_FREEBSD)
+  shmctl(shminfo->shmid, IPC_RMID, 0);
+#endif
 }
 
 BackingStoreX::BackingStoreX(RenderWidgetHost* widget,
@@ -344,7 +347,9 @@ bool BackingStoreX::CopyFromBackingStore
     }
 
     void* mapped_memory = shmat(shminfo.shmid, NULL, SHM_RDONLY);
+#if !defined(OS_FREEBSD)
     shmctl(shminfo.shmid, IPC_RMID, 0);
+#endif
     if (mapped_memory == (void*)-1) {
       XDestroyImage(image);
       return false;
