$NetBSD$

--- make/unix.mak.orig	Thu Jul 24 22:01:42 2003
+++ make/unix.mak
@@ -66,13 +66,13 @@
 #
 
 ifndef PWLIBDIR
-PWLIBDIR = $(HOME)/pwlib
+PWLIBDIR = /usr/pkg 
 endif
 
 ####################################################
 
 # include generated build options file, then include it
-include $(PWLIBDIR)/make/ptbuildopts.mak
+include $(PWLIBDIR)/share/pwlib/make/ptbuildopts.mak
 
 ###############################################################################
 #
@@ -404,9 +404,7 @@ endif # OpenBSD
 
 ifeq ($(OSTYPE),NetBSD)
 
-ifeq ($(MACHTYPE),x86)
-STDCCFLAGS	+= -m486
-endif
+P_PTHREADS	:= 1
 
 ifndef OSRELASE
 OSRELEASE   := $(shell /sbin/sysctl -n kern.osrevision)
@@ -415,37 +413,19 @@ endif
 STDCCFLAGS	+= -DP_NETBSD=$(OSRELEASE)
 LDLIBS		+= -lossaudio
 
-STDCCFLAGS += -I$(UNIX_INC_DIR) -I$(PWLIBDIR)/include
-
-# enable the USE_PTH line to compile using pth
-# enable the USE_NATIVE_THREADS line to compile using native threads
-# enable the USE_UNPROVEN_THREADS line to compile using unproven threads
-#USE_PTH_THREADS := 1
-#USE_UNPROVEN_THREADS := 1
-USE_NATIVE_THREADS := 1
-
 ifdef P_PTHREADS
-ifdef USE_NATIVE_THREADS
-LDLIBS  += -lpthread
-else
-ifdef USE_PTH_THREADS
-STDCCFLAGS += -DP_GNU_PTH
-STDCCFLAGS += -I/usr/pkg/include
-LDFLAGS += -L/usr/pkg/lib
-LDLIBS  += -lpthread
-else
-STDCCFLAGS += -DP_NO_CANCEL
-STDCCFLAGS += -I/usr/pkg/pthreads/include
-LDFLAGS	+= -L/usr/pkg/pthreads/lib
-LDLIBS	+= -lpthread
-CC              := /usr/pkg/pthreads/bin/pgcc
-CPLUS           := /usr/pkg/pthreads/bin/pg++
-endif
-endif
+# need to put $(PREFIX)/include after library includes, so that
+# the build wouldn't pick up potential intalled pwlib headers
+# from $(PREFIX)
+STDCCFLAGS += -I$(UNIX_INC_DIR) -I$(PWLIBDIR)/include -I/usr/pkg/include
+LDFLAGS += -L/usr/pkg/lib -lpthread
 endif
 
+
+
+
 P_USE_RANLIB		:= 1
-STDCCFLAGS      += -DP_USE_PRAGMA
+STDCCFLAGS	+= -DP_USE_PRAGMA
 
 
 endif # NetBSD
@@ -853,8 +833,8 @@ STATICLIBEXT = a
 endif
 
 ifeq ($(P_SHAREDLIB),1)
-LIB_SUFFIX	= $(SHAREDLIBEXT)
-else   
+LIB_SUFFIX	= la
+else 
 LIB_SUFFIX	= a 
 ifndef DEBUG
 LIB_TYPE	= _s
@@ -865,8 +845,10 @@ ifndef LIB_TYPE
 LIB_TYPE	=
 endif
 
+INSTALL_DIR = ${PREFIX}
+
 ifndef INSTALL_DIR
-INSTALL_DIR	= /usr/local
+INSTALL_DIR	= /usr/pkg
 endif
 
 ifndef INSTALLBIN_DIR
@@ -891,12 +873,7 @@ SHELL		:= /bin/sh
 
 # Directories
 
-ifdef PREFIX
-UNIX_INC_DIR	= $(PREFIX)/include/ptlib/unix
-else
 UNIX_INC_DIR	= $(PWLIBDIR)/include/ptlib/unix
-endif
-
 ifndef UNIX_SRC_DIR
 UNIX_SRC_DIR	= $(PWLIBDIR)/src/ptlib/unix
 endif
@@ -904,7 +881,7 @@ endif
 PW_LIBDIR	= $(PWLIBDIR)/lib
 
 # set name of the PT library
-PTLIB_BASE	= pt_$(PLATFORM_TYPE)_$(OBJ_SUFFIX)
+PTLIB_BASE	= pt
 PTLIB_FILE	= lib$(PTLIB_BASE)$(LIB_TYPE).$(LIB_SUFFIX)
 PT_OBJBASE	= obj_$(PLATFORM_TYPE)_$(OBJDIR_SUFFIX)
 PT_OBJDIR	= $(PW_LIBDIR)/$(PT_OBJBASE)
@@ -966,12 +943,12 @@ endif
 #STDCCFLAGS     += -fno-implement-inlines
 
 # add OS directory to include path
-STDCCFLAGS	+= -I$(UNIX_INC_DIR) -I/usr/include/pwlib
+STDCCFLAGS	+= -I$(UNIX_INC_DIR)
 
 
 # add library directory to library path and include the library
 LDFLAGS		+= -L$(PW_LIBDIR)
 
-LDLIBS		+= -l$(PTLIB_BASE)$(LIB_TYPE)
+LDLIBS		+= $(PW_LIBDIR)/$(PTLIB_FILE) 
 
 # End of unix.mak
