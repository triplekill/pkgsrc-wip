$NetBSD$

--- gkrellm_snmp.c.orig	2003-09-21 14:49:36.000000000 +0200
+++ gkrellm_snmp.c
@@ -987,16 +987,19 @@ load_plugin_config(gchar *arg)
   gchar   proto[CFG_BUFSIZE], bufl[CFG_BUFSIZE];
   gchar   bufc[CFG_BUFSIZE], bufp[CFG_BUFSIZE];
   gchar   bufo[CFG_BUFSIZE], bufu[CFG_BUFSIZE];
+  gchar   bufpr[CFG_BUFSIZE], bufpeer[CFG_BUFSIZE];
   gint    n;
 
   reader = g_new0(Reader, 1); 
 
-  n = sscanf(arg, "%s %[^:]://%[^@]@%[^:]:%d/%s %s %d %d %d %d",
-	     bufl, proto, bufc, bufp, &reader->port, bufo, bufu,
+  n = sscanf(arg, "%s %[^:]://%[^@]@%[^:]:%[^:]:%d/%s %s %d %d %d %d",
+	     bufl, proto, bufc, bufpr, bufpeer, &reader->port, bufo, bufu,
 	     &reader->delay, &reader->delta,
 	     &reader->divisor, &reader->scale);
   if (n >= 6)
     {
+      g_snprintf(bufp, CFG_BUFSIZE, "%s:%s", bufpr, bufpeer);
+      bufp[CFG_BUFSIZE-1] = '\0';
       if (g_strcasecmp(proto, "snmp") == 0) {
 	gkrellm_dup_string(&reader->label, bufl);
 	gkrellm_dup_string(&reader->community, bufc);
@@ -1055,6 +1058,7 @@ apply_plugin_config()
   for (row = 0; row < GTK_CLIST(reader_clist)->rows; ++row)
     {
       gint i;
+      gchar peername[MAXHOSTNAMELEN+1];
       i = 0;
       reader = g_new0(Reader, 1);
 
@@ -1062,6 +1066,11 @@ apply_plugin_config()
       gkrellm_dup_string(&reader->label, name);
 
       gtk_clist_get_text(GTK_CLIST(reader_clist), row, i++, &name);
+      if (strncasecmp(name, "tcp:", 4) && strncasecmp(name, "udp:", 4))
+        {
+          g_snprintf(peername, MAXHOSTNAMELEN, "udp:%s", name);
+          name = peername;
+        }
       gkrellm_dup_string(&reader->peer, name);
 
       gtk_clist_get_text(GTK_CLIST(reader_clist), row, i++, &name);
