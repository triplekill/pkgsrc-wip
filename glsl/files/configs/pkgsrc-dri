include $(TOP)/configs/pkgsrc

# This is generated by configure
CONFIG_NAME = pkgsrc-dri

# Compiler and flags
DEFINES =  -DHAVE_POSIX_MEMALIGN -DPTHREADS -DUSE_EXTERNAL_DXTN_LIB=1 -DIN_DRI_DRIVER -DHAVE_ALIAS -DGLX_INDIRECT_RENDERING -DGLX_DIRECT_RENDERING
API_DEFINES =  -DFEATURE_GL=1
GLES_OVERLAY = 0
CFLAGS += $(WARN_FLAGS) -Wmissing-prototypes -Wall $(X11_INCLUDES) \
	$(OPT_FLAGS) $(PIC_FLAGS) $(ARCH_FLAGS) $(ASM_FLAGS) $(DEFINES)
CXXFLAGS += $(WARN_FLAGS) -Wall $(X11_INCLUDES) \
	$(OPT_FLAGS) $(PIC_FLAGS) $(ARCH_FLAGS) $(DEFINES)

EXTRA_LIB_PATH = 
RADEON_CFLAGS = -DHAVE_LIBDRM_RADEON=1 `$(PKG_CONFIG) --cflags libdrm_radeon`
RADEON_LDFLAGS = `$(PKG_CONFIG) --libs libdrm_radeon`
INTEL_LIBS = `$(PKG_CONFIG) --libs libdrm_intel`
INTEL_CFLAGS = `$(PKG_CONFIG) --cflags libdrm_intel`
X11_LIBS = `$(PKG_CONFIG) --libs x11`
X11_CFLAGS = `$(PKG_CONFIG) --cflags x11`

TALLOC_LIBS = `$(PKG_CONFIG) --libs talloc`
TALLOC_CFLAGS = `$(PKG_CONFIG) --cflags talloc`

# Source selection
MESA_ASM_SOURCES ?= # defined
GLAPI_ASM_SOURCES ?= # defined

# Directories to build
LIB_DIR = lib
SRC_DIRS = mapi/glapi glsl mesa  glx
GLU_DIRS = sgi
DRIVER_DIRS = dri
EGL_DRIVERS_DIRS = 
GALLIUM_DIRS = auxiliary drivers state_trackers
GALLIUM_DRIVERS_DIRS = softpipe failover galahad trace rbug identity svga i915 i965 r300
GALLIUM_WINSYS_DIRS = sw sw/xlib sw/dri i915/sw radeon/drm
GALLIUM_TARGET_DIRS =  dri-r300 dri-swrast
GALLIUM_STATE_TRACKERS_DIRS = dri
GALLIUM_AUXILIARIES = $(TOP)/src/gallium/auxiliary/libgallium.a
GALLIUM_DRIVERS = $(foreach DIR,$(GALLIUM_DRIVERS_DIRS),$(TOP)/src/gallium/drivers/$(DIR)/lib$(DIR).a)

# Driver specific build vars
DRI_DIRS = i810 i915 i965 mach64 mga r128 r200 r300 r600 radeon tdfx unichrome savage sis swrast 
EGL_PLATFORMS = 
EGL_CLIENT_APIS = $(GL_LIB)

# Dependencies
X11_INCLUDES = `$(PKG_CONFIG) --cflags x11`

# GLw motif setup
GLW_SOURCES = 
MOTIF_CFLAGS = 

# Library/program dependencies
GL_LIB_DEPS = $(EXTRA_LIB_PATH) -lX11 -lXext -lXdamage -lXfixes -lXxf86vm `$(PKG_CONFIG) --libs libdrm` -lm $(PTHREAD_STUBLIB)
OSMESA_LIB_DEPS = -L$(TOP)/$(LIB_DIR)  \
	$(EXTRA_LIB_PATH) 
EGL_LIB_DEPS = $(EXTRA_LIB_PATH) 
GLU_LIB_DEPS = -L$(TOP)/$(LIB_DIR)  \
	$(EXTRA_LIB_PATH)  
GLUT_LIB_DEPS = -L$(TOP)/$(LIB_DIR)  \
	$(EXTRA_LIB_PATH) 
GLW_LIB_DEPS = -L$(TOP)/$(LIB_DIR)  \
	$(EXTRA_LIB_PATH) 
APP_LIB_DEPS = $(EXTRA_LIB_PATH) -lm
GLESv1_CM_LIB_DEPS = $(EXTRA_LIB_PATH) -Wl,-R/usr/pkg/lib -L/usr/pkg/lib -ldrm   -lm -lpthread 
GLESv2_LIB_DEPS = $(EXTRA_LIB_PATH) -Wl,-R/usr/pkg/lib -L/usr/pkg/lib -ldrm   -lm -lpthread 
VG_LIB_DEPS = $(EXTRA_LIB_PATH) 

# DRI dependencies
#DRI_LIB_DEPS = $(EXTRA_LIB_PATH)  -Wl,-R/usr/pkg/lib -L/usr/pkg/lib -ldrm   -lexpat -lm -lpthread  -Wl,-R/usr/pkg/lib -L/usr/pkg/lib -ltalloc  
LIBDRM_CFLAGS = `$(PKG_CONFIG) --cflags libdrm`
LIBDRM_LIB = `$(PKG_CONFIG) --libs libdrm`
DRI2PROTO_CFLAGS = `$(PKG_CONFIG) --cflags dri2proto`
EXPAT_INCLUDES = 

# DRI installation directories
DRI_DRIVER_INSTALL_DIR = ${libdir}/dri

# Where libGL will look for DRI hardware drivers
DRI_DRIVER_SEARCH_DIR = ${DRI_DRIVER_INSTALL_DIR}

# EGL driver install directory
EGL_DRIVER_INSTALL_DIR = ${libdir}/egl

# Xorg driver install directory (for xorg state-tracker)
XORG_DRIVER_INSTALL_DIR = ${exec_prefix}/lib/xorg/modules/drivers
