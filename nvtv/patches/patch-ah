$NetBSD$

--- configure.in.orig	2003-05-30 11:33:51.000000000 +0200
+++ configure.in
@@ -172,7 +172,7 @@ if test ${with_x} = yes ; then
   AC_DEFINE(HAVE_X,1,[Define to 1 if X is available and used.])
   OBJS_EXTRA="$OBJS_EXTRA actions.o"
   if test ${have_gtk} != no ; then
-    have_gtk_version=`expr substr ${have_gtk} 4 1`
+    have_gtk_version=`expr ${have_gtk} : '^gtk\([[12]]\)'`
     AC_DEFINE(HAVE_GTK,1,[Define to 1 if GTK is available and used.])
     AC_DEFINE_UNQUOTED(HAVE_GTK_VERSION,${have_gtk_version},[Define to 1/2 for GTK major version.])
     OBJS_GUI="gui.o gui_bt.o gui_cx.o gui_ch.o gui_ph.o gui_nv.o gui_tdfx.o gui_i810.o"
@@ -240,14 +240,24 @@ dnl 
 AC_CHECK_LIB(m,sin,LIBS="$LIBS -lm",
   AC_MSG_ERROR(math library required))
 
+case ${host} in
+  *-*-netbsd*)
+    AC_CHECK_LIB(i386,i386_iopl,LIBS="$LIBS -li386",
+      AC_MSG_ERROR(NetBSD i386 library required))
+    AC_CHECK_LIB(pci,pcibus_conf_read,LIBS="$LIBS -lpci",
+      AC_MSG_ERROR(NetBSD pci library required))
+  ;;
+esac
+
 if test ${with_winio} = yes ; then
   AC_CHECK_LIB(winio,winio_init,LIBS="$LIBS -lwinio",
     AC_MSG_ERROR(winio wrapper library required))
 fi
 
 if test ${host_flag} = unix -o ${with_winio} = yes ; then
-  AC_CHECK_LIB(pci,pci_init,LIBS="$LIBS -lpci",
-    AC_MSG_ERROR(pci library required))
+  AC_CHECK_LIB(pci,pci_init,LIBS="$LIBS -lpci" pciutils_libname="pci",
+    AC_CHECK_LIB(pciutils,pci_init,LIBS="$LIBS -lpciutils" pciutils_libname="pciutils",
+      AC_MSG_ERROR(pci library required)))
 fi
 
 dnl
@@ -272,9 +282,12 @@ AC_HEADER_STDC
 AC_CHECK_HEADERS(sys/io.h)
 
 if test ${host_flag} = unix -o ${with_winio} = yes ; then
-  AC_CHECK_HEADER(pci/pci.h,,
-    AC_MSG_ERROR(pci library header 'pci/pci.h' required))
+  AC_CHECK_HEADER(${pciutils_libname}/pci.h,,
+    AC_MSG_WARN(pci library header \'${pciutils_libname}/pci.h\' required))
   AC_DEFINE(HAVE_PCI,1,[Define to 1 if pciutils available and used.])
+  if test ${pciutils_libname} = pciutils ; then
+    AC_DEFINE(HAVE_PCIUTILS,1,[Define to 1 if pciutils library is named 'pciutils'.])
+  fi
 fi
 
 if test ${with_winio} = yes ; then
