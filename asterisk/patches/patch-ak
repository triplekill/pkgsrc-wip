$NetBSD$

--- work.i386/asterisk-0.4.0/channels/chan_iax2.c-	2003-08-24 10:01:44.000000000 +0900
+++ work.i386/asterisk-0.4.0/channels/chan_iax2.c	2003-08-24 10:02:32.000000000 +0900
@@ -34,6 +34,9 @@
 #include <arpa/inet.h>
 #include <sys/socket.h>
 #include <netinet/in.h>
+#ifdef __NetBSD__
+#include <netinet/in_systm.h>
+#endif
 #include <netinet/ip.h>
 #include <sys/time.h>
 #include <sys/signal.h>
@@ -5004,6 +5007,9 @@
 		} else if (!strcasecmp(v->name, "register")) {
 			iax2_register(v->value, v->lineno);
 		} else if (!strcasecmp(v->name, "tos")) {
+#ifndef IPTOS_MINCOST
+#define IPTOS_MINCOST	0x01
+#endif
 			if (sscanf(v->value, "%i", &format) == 1)
 				tos = format & 0xff;
 			else if (!strcasecmp(v->value, "lowdelay"))
@@ -5520,7 +5526,11 @@
 	if (option_verbose > 1)
 		ast_verbose(VERBOSE_PREFIX_2 "Using TOS bits %d\n", tos);
 
+#ifdef SOL_IP
 	if (setsockopt(netsocket, SOL_IP, IP_TOS, &tos, sizeof(tos))) 
+#else
+	if (setsockopt(netsocket, IPPROTO_IP, IP_TOS, &tos, sizeof(tos))) 
+#endif
 		ast_log(LOG_WARNING, "Unable to set TOS to %d\n", tos);
 	
 	if (!res) {
