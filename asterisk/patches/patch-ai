$NetBSD$

--- work.i386/asterisk-0.4.0/channels/chan_sip.c-	2003-08-24 09:56:34.000000000 +0900
+++ work.i386/asterisk-0.4.0/channels/chan_sip.c	2003-08-24 09:57:59.000000000 +0900
@@ -45,6 +45,9 @@
 #include <netdb.h>
 #include <arpa/inet.h>
 #include <sys/signal.h>
+#ifdef __NetBSD__
+#include <netinet/in_systm.h>
+#endif
 #include <netinet/ip.h>
 
 /* #define VOCAL_DATA_HACK */
@@ -5110,6 +5113,9 @@
 		} else if (!strcasecmp(v->name, "register")) {
 			sip_register(v->value, v->lineno);
 		} else if (!strcasecmp(v->name, "tos")) {
+#ifndef IPTOS_MINCOST
+#define IPTOS_MINCOST	0x01
+#endif
 			if (sscanf(v->value, "%i", &format) == 1)
 				tos = format & 0xff;
 			else if (!strcasecmp(v->value, "lowdelay"))
@@ -5207,7 +5213,11 @@
 				if (option_verbose > 1)
 					ast_verbose(VERBOSE_PREFIX_2 "Using TOS bits %d\n", tos);
 
+#ifdef SOL_IP
 				if (setsockopt(sipsock, SOL_IP, IP_TOS, &tos, sizeof(tos))) 
+#else
+				if (setsockopt(sipsock, IPPROTO_IP, IP_TOS, &tos, sizeof(tos))) 
+#endif
 					ast_log(LOG_WARNING, "Unable to set TOS to %d\n", tos);
 	
 			}
