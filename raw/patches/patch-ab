$NetBSD$

This includes sound-20040508.diff from the master site.

--- engine.cpp.orig	Mon Apr 19 21:01:30 2004
+++ engine.cpp
@@ -23,14 +23,13 @@
 
 
 Engine::Engine(SystemStub *stub, const char *dataDir, const char *saveDir)
-	: _stub(stub), _log(&_res, &_vid, stub), _res(&_vid, dataDir), _vid(&_res, stub), 
+	: _stub(stub), _log(&_mix, &_res, &_vid, stub), _mix(_stub), _res(&_vid, dataDir), _vid(&_res, stub), 
 	_dataDir(dataDir), _saveDir(saveDir), _stateSlot(0) {
 }
 
 void Engine::run() {
 	_stub->init("Out Of This World");
 	setup();
-	// XXX
 	_log.restartAt(0x3E80); // demo starts at 0x3E81
 	while (!_stub->_pi.quit) {
 		_log.setupScripts();
@@ -47,10 +46,11 @@ void Engine::setup() {
 	_res.allocMemBlock();
 	_res.readEntries();
 	_log.init();
+	_mix.init();
 }
 
 void Engine::finish() {
-	 // XXX
+	 _mix.free();
 	 _res.freeMemBlock();
 }
 
@@ -100,6 +100,7 @@ void Engine::saveGameState(uint8 slot, c
 		_log.saveOrLoad(s);
 		_res.saveOrLoad(s);
 		_vid.saveOrLoad(s);
+		// XXX _mix.saveOrLoad(s);
 		if (f.ioErr()) {
 			warning("I/O error when saving game state");
 		} else {
@@ -128,6 +129,7 @@ void Engine::loadGameState(uint8 slot) {
 			_log.saveOrLoad(s);
 			_res.saveOrLoad(s);
 			_vid.saveOrLoad(s);
+			// XXX _mix.saveOrLoad(s);
 		}
 		if (f.ioErr()) {
 			warning("I/O error when loading game state");
