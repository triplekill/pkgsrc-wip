# $NetBSD$

###########################################################
#               Generated by fbsd2pkg                     #
###########################################################

###########################################################
# Unconverted and partially converted FreeBSD port syntax:

# # configure chooses /usr/local/bin/ar with no flags
# # FreeBSD boost port flagged by configure as untested version
# # configure script falsely indicates that it supports --mandir and --infodir
# # Fix undefined _ThreadRuneLocale on 10.0
# post-install:
# 	${STRIP_CMD} ${DESTDIR}${PREFIX}/lib/*.so

PKGNAME=	blast-2.2.29
DISTNAME=	${PKGNAMEPREFIX}-blast-2.2.29+-src
CATEGORIES=	biology
MASTER_SITES=	ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/

MAINTAINER=	jwbacon@tds.net

COMMENT=	Basic Local Alignment Search Tool
# LICENSE=	

# Pessimistic assumption.  Test and change if possible.
MAKE_JOBS_SAFE=	no

# Just assuming C and C++: Adjust this!
USE_LANGUAGES=	c c++
USE_TOOLS+=	gmake
# GNU_CONFIGURE inserts --with-libiconv-prefix, which is not supported
HAS_CONFIGURE=	yes
REPLACE_PERL=	src/app/blast/legacy_blast.pl \
 		src/app/blast/update_blastdb.pl
REPLACE_PYTHON=	src/app/winmasker/windowmasker_2.2.22_adapter.py

WRKSRC=		${WRKDIR}/${DISTNAME}/c++

# Adapt REINPLACE commands to SUBST:
SUBST_CLASSES+=		destdir
SUBST_STAGE.destdir+=	post-patch
SUBST_FILES.destdir+=	${WRKSRC}/src/build-system/Makefile.in.top
SUBST_SED.destdir+=	's|@prefix@|${DESTDIR}@prefix@|g'

# Needed for FreeBSD port on FreeBSD 10.0
# post-patch:
# 	${REINPLACE_CMD} \
# 		-e "s|-D_THREAD_SAFE|-D_THREAD_SAFE -D__RUNETYPE_INTERNAL|g" \
# 		${WRKSRC}/src/build-system/configure

# Since we're using HAS_CONFIGURE, manually add usable flags generated by
# GNU_CONFIGURE in addition to our own add-ons.
CONFIGURE_ARGS+=AR="ar cr" --without-boost --prefix=${PREFIX}
DATADIR=	${PREFIX}/share/blast
DOCSDIR=	${PREFIX}/share/doc/blast
PKGNAMEPREFIX=	ncbi

# Sets OPSYS, OS_VERSION, MACHINE_ARCH, etc..
# .include "../../mk/bsd.prefs.mk"

# Keep this if there are user-selectable options.
# .include "options.mk"

# Guess based on FreeBSD USE_PYTHON_RUN=yes
.include "../../lang/python/application.mk"
.include "../../devel/pcre/buildlink3.mk"
.include "../../devel/zlib/buildlink3.mk"
.include "../../archivers/bzip2/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
