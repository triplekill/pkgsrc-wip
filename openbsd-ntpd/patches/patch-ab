$NetBSD$

--- ntp.c.orig	Thu Mar 24 15:50:07 2005
+++ ntp.c	Mon Apr 11 00:12:49 2005
@@ -119,7 +119,8 @@ ntp_main(int pipe_prnt[2], struct ntpd_c
 
 	if (setgroups(1, &pw->pw_gid) ||
 	    setegid(pw->pw_gid) || setgid(pw->pw_gid) ||
-	    seteuid(pw->pw_uid) || setuid(pw->pw_uid))
+	    (setuid(pw->pw_uid) && (getuid() != pw->pw_uid)) ||
+	    (seteuid(pw->pw_uid) && (geteuid() != pw->pw_uid)))
 		fatal("can't drop privileges");
 
 	endpwent();
