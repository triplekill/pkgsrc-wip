$NetBSD$

--- h/NetBSD.h.orig	1999-12-07 01:44:02.000000000 +0300
+++ h/NetBSD.h	2008-02-16 23:40:01.000000000 +0300
@@ -30,8 +30,8 @@
 
 */
 
+#include <signal.h>
 #include "bsd.h"
-/*#include "386.h" /* NOT if you want this to work on 386bsd!!!*/
 
 #define ADDITIONAL_FEATURES \
 		     ADD_FEATURE("386BSD");\
@@ -55,8 +55,10 @@
 #undef LISTEN_FOR_INPUT		/* default in bsd.h is loser in 386bsd */
 
 #define LISTEN_FOR_INPUT(fp) \
-  if((fp)->_r <=0 && (c=0,ioctl((fp)->_file, FIONREAD, &c),c<=0)) \
-  return 0;
+	do {	int c;						\
+		if((fp)->_r <=0 && (c=0,ioctl((fp)->_file, FIONREAD, &c),c<=0)) \
+			return 0;				\
+	} while(0)
 
 /* end listen for input */
 
@@ -79,12 +79,16 @@
 /* begin setup alternate signal stack */
 #define SIG_STACK_SIZE SIGSTKSZ
 #define SETUP_SIG_STACK \
-{ static struct sigaltstack estack ; \
-  estack.ss_size = sizeof(estack_buf) ; \
-  estack.ss_flags = 0; \
-  estack.ss_base = (char *) &estack_buf[SIG_STACK_SIZE-1]; \
-  if (sigaltstack(&estack, (struct sigaltstack *)0) < 0) \
-               perror("sigaltstack");} \
+	{ static stack_t estack ; /* in <sys/sigtypes.h> */		\
+		/* copied from powerpc-macosx.h -- ASau */		\
+		static double estack_buf [SIG_STACK_SIZE];		\
+		bzero(estack_buf, sizeof(estack_buf));			\
+		estack.ss_size = sizeof(estack_buf) ;			\
+		estack.ss_flags = 0;					\
+		estack.ss_sp = (char *) &estack_buf[SIG_STACK_SIZE-1];	\
+		if (sigaltstack(&estack, (stack_t *)0) < 0)		\
+			perror("sigaltstack");				\
+	}								\
 
 /* end setup signal stack  */
 
