# $NetBSD$

DISTNAME=		avahi-0.6.23
CATEGORIES=		net
MASTER_SITES=		http://avahi.org/download/

MAINTAINER=		adrianp@NetBSD.org
HOMEPAGE=		http://avahi.org/
COMMENT=		Facilitate service discovery on a local network

GNU_CONFIGURE=		YES
USE_DIRS+=		xdg-1.4
USE_LIBTOOL=		YES
USE_PKGINSTALL=		YES
USE_PKGLOCALEDIR=	YES
USE_TOOLS+=		pkg-config gmake intltool
MAKE_JOBS_SAFE=		no

PKGCONFIG_OVERRIDE+=	avahi-client.pc.in
PKGCONFIG_OVERRIDE+=	avahi-compat-howl.pc.in
PKGCONFIG_OVERRIDE+=	avahi-compat-libdns_sd.pc.in
PKGCONFIG_OVERRIDE+=	avahi-core.pc.in
PKGCONFIG_OVERRIDE+=	avahi-glib.pc.in
PKGCONFIG_OVERRIDE+=	avahi-qt3.pc.in
PKGCONFIG_OVERRIDE+=	avahi-qt4.pc.in
PKGCONFIG_OVERRIDE+=	avahi-sharp.pc.in
PKGCONFIG_OVERRIDE+=	avahi-ui-sharp.pc.in
PKGCONFIG_OVERRIDE+=	avahi-ui.pc.in

AVAHI_USER=		avahi
AVAHI_GROUP=		avahi
RCD_SCRIPTS=		avahidaemon
BUILD_DEFS=		VARBASE PKG_SYSCONFBASE
PLIST_SRC=		${WRKDIR}/.PLIST_SRC
PKG_SYSCONFSUBDIR=	avahi
USE_LANGUAGES=		c c++

PKG_USERS=		${AVAHI_USER}:${AVAHI_GROUP}::Avahi\ user:/nonexistent
PKG_GROUPS=		${AVAHI_GROUP}

.include "options.mk"

PLIST_SRC+=		${PKGDIR}/PLIST.shared

CONF_FILES+=		${PREFIX}/share/examples/avahi/avahi-daemon.conf \
			${PKG_SYSCONFDIR}/avahi-daemon.conf
CONF_FILES+=		${PREFIX}/share/examples/avahi/hosts \
			${PKG_SYSCONFDIR}/hosts
CONF_FILES+=		${PREFIX}/share/examples/avahi/avahi-dnsconfd.action \
			${PKG_SYSCONFDIR}/avahi-dnsconfd.action
CONF_FILES+=		${PREFIX}/share/examples/avahi/ssh.service \
			${PKG_SYSCONFDIR}/services/ssh.service

# CONFIGURE_ARGS+=	--with-distro=netbsd
CONFIGURE_ARGS+=	--with-avahi-user=${AVAHI_USER:Q}
CONFIGURE_ARGS+=	--with-avahi-group=${AVAHI_GROUP:Q}
CONFIGURE_ARGS+=	--localstatedir=${VARBASE:Q}
CONFIGURE_ARGS+=	--sysconfdir=${PKG_SYSCONFBASE}
CONFIGURE_ARGS+=	--disable-qt3
CONFIGURE_ARGS+=	--disable-qt4
CONFIGURE_ARGS+=	--disable-mono
CONFIGURE_ARGS+=	--disable-monodoc
CONFIGURE_ARGS+=	--disable-doxygen-doc
CONFIGURE_ARGS+=	--disable-doxygen-dot
CONFIGURE_ARGS+=	--disable-doxygen-html
CONFIGURE_ARGS+=	--disable-xmltoman
CONFIGURE_ARGS+=	--disable-autoipd

post-extract:
	${CP} ${PKGDIR}/PLIST ${WRKDIR}/.PLIST_SRC

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/avahi
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/avahi
	${MKDIR} ${PKG_SYSCONFDIR}/services

	${INSTALL_DATA} ${WRKSRC}/avahi-daemon/avahi-daemon.conf \
		${PREFIX}/share/examples/avahi
	${INSTALL_DATA} ${WRKSRC}/avahi-daemon/hosts \
		${PREFIX}/share/examples/avahi
	${INSTALL_DATA} ${WRKSRC}/avahi-dnsconfd/avahi-dnsconfd.action \
		${PREFIX}/share/examples/avahi
	${INSTALL_DATA} ${WRKSRC}/avahi-daemon/ssh.service \
		${PREFIX}/share/examples/avahi

.	if !empty(PKG_OPTIONS:Mdbus)
		${INSTALL_DATA} ${WRKSRC}/avahi-daemon/avahi-dbus.conf \
			${PREFIX}/share/examples/avahi/avahi-dbus.conf
.	endif

	${INSTALL_DATA} ${WRKSRC}/docs/HACKING ${PREFIX}/share/doc/avahi
	${INSTALL_DATA} ${WRKSRC}/docs/INSTALL ${PREFIX}/share/doc/avahi
	${INSTALL_DATA} ${WRKSRC}/docs/NEWS ${PREFIX}/share/doc/avahi
	${INSTALL_DATA} ${WRKSRC}/docs/README ${PREFIX}/share/doc/avahi
	${INSTALL_DATA} ${WRKSRC}/docs/TODO ${PREFIX}/share/doc/avahi

.include "../../textproc/expat/buildlink3.mk"
.include "../../wip/libdaemon/buildlink3.mk"
.include "../../devel/glib2/buildlink3.mk"
.include "../../mk/pthread.buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
