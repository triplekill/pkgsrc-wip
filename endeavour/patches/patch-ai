$NetBSD$

--- endeavour2/lib/edvdevicesfio.c.orig	2006-01-31 02:40:45.000000000 -0500
+++ endeavour2/lib/edvdevicesfio.c
@@ -10,6 +10,9 @@
 #elif defined(__SOLARIS__)
 # include <sys/mnttab.h>
 # include <sys/vfstab.h>
+#elif defined(__NetBSD__)
+# include <fstab.h>
+# include <sys/statvfs.h>
 #else
 # include <mntent.h>
 #endif
@@ -67,6 +70,9 @@ void EDVDevicesListUpdateMountStatesFrom
 #if defined(__FreeBSD__)
         gint i, mntsize;  
         struct statfs *mt_buf;
+#elif defined(__NetBSD__)
+	gint i, mntsize;
+	struct statvfs *mt_buf;
 #elif defined(__SOLARIS__)
 	struct mnttab *mt_ptr;
 	int mtback;
@@ -88,7 +94,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	}
 
 	/* Open the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	fp = (FILE *)1;		/* Mark the mount info file as opened */
 #elif defined(__SOLARIS__)
 	fp = FOpen("/etc/mnttab", "rb");
@@ -99,7 +105,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	    return;
 
 	/* Begin reading the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
         if((mntsize = getmntinfo(&mt_buf, MNT_NOWAIT)) == 0)
             return;
         i = mntsize - 1;
@@ -119,7 +125,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	    dev = EDVDeviceListMatchDevicePath(
 		list, total,
 		&dev_num,
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		mt_buf[i].f_mntfromname
 #elif defined(__SOLARIS__)
 		mt_ptr->mnt_special
@@ -139,7 +145,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	    dev = EDVDeviceListMatchMountPath(
 		list, total,
 		&dev_num,
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
                 mt_buf[i].f_mntonname
 #elif defined(__SOLARIS__)
 		mt_ptr->mnt_mountp
@@ -154,7 +160,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	    }
 
 	    /* Get the next mount entry */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	    i--;
 #elif defined(__SOLARIS__)
 	    mtback = getmntent(fp, mt_ptr);
@@ -165,7 +171,7 @@ void EDVDevicesListUpdateMountStatesFrom
 
 
 	/* Close the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	fp = NULL;	/* Mark the mount info file as closed */
 #elif defined(__SOLARIS__)
 	FClose(fp);
