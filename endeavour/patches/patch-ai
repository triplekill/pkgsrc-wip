$NetBSD$

--- endeavour2/lib/edv_devices_list.c.orig	2008-02-02 17:00:00.000000000 -0500
+++ endeavour2/lib/edv_devices_list.c
@@ -9,6 +9,9 @@
 #elif defined(__SOLARIS__)
 # include <sys/mnttab.h>
 # include <sys/vfstab.h>
+#elif defined(__NetBSD__)
+# include <fstab.h>
+# include <sys/statvfs.h>
 #else
 # include <mntent.h>
 # include <sys/vfs.h>
@@ -67,6 +70,9 @@ void EDVDevicesListUpdateMountStatesFrom
 #if defined(__FreeBSD__)
 	gint i, mntsize;  
 	struct statfs *mt_buf;
+#elif defined(__NetBSD__)
+        gint i, mntsize;
+        struct statvfs *mt_buf;
 #elif defined(__SOLARIS__)
 	struct mnttab *mt_ptr;
 	int mtback;
@@ -93,7 +99,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	}
 
 	/* Open the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	fp = (FILE *)1;		/* Mark the mount info file as opened */
 #elif defined(__SOLARIS__)
 	fp = fopen("/etc/mnttab", "rb");
@@ -104,7 +110,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	    return;
 
 	/* Begin reading the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	if((mntsize = getmntinfo(&mt_buf, MNT_NOWAIT)) == 0)
 	    return;
 	i = mntsize - 1;
@@ -124,7 +130,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	    d = EDVDeviceListMatchDevicePath(
 		devices_list,
 		NULL,				/* No index return */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		mt_buf[i].f_mntfromname		/* Device path */
 #elif defined(__SOLARIS__)
 		mt_ptr->mnt_special		/* Device path */
@@ -144,7 +150,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	    d = EDVDeviceListMatchMountPath(
 		devices_list,
 		NULL,				/* No index return */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		mt_buf[i].f_mntonname		/* Mount path */
 #elif defined(__SOLARIS__)
 		mt_ptr->mnt_mountp		/* Mount path */
@@ -159,7 +165,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	    }
 
 	    /* Get the next mount entry */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	    i--;
 #elif defined(__SOLARIS__)
 	    mtback = getmntent(fp, mt_ptr);
@@ -169,7 +175,7 @@ void EDVDevicesListUpdateMountStatesFrom
 	}
 
 	/* Close the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	fp = NULL;		/* Mark the mount info file as closed */
 #elif defined(__SOLARIS__)
 	fclose(fp);
@@ -223,7 +229,7 @@ void EDVDevicesListUpdateStatsFromSystem
             mount_path = d->mount_path;
             if(EDV_DEVICE_IS_MOUNTED(d) && !STRISEMPTY(mount_path))
             {
-#if defined(__SOLARIS__)
+#if defined(__SOLARIS__)||defined(__NetBSD__)
                 struct statvfs buf;
                 if(!statvfs((const char *)mount_path, &buf))
 #else
@@ -265,7 +271,11 @@ void EDVDevicesListUpdateStatsFromSystem
 #else
                     d->fs_id = 0;
 #endif
+#if defined(__NetBSD__)
+                    d->name_length_max = (gulong)buf.f_namemax;
+#else
                     d->name_length_max = (gulong)buf.f_namelen;
+#endif
                 }
             }
         }
