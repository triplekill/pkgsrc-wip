$NetBSD$

--- endeavour2/edv_devices_list.c.orig	2006-07-01 20:44:00.000000000 -0400
+++ endeavour2/edv_devices_list.c
@@ -9,6 +9,9 @@
 #elif defined(__SOLARIS__)
 # include <sys/mnttab.h>
 # include <sys/vfstab.h>
+#elif defined(__NetBSD__)
+# include <fstab.h>
+# include <sys/statvfs.h>
 #else
 # include <mntent.h>
 # include <sys/vfs.h>
@@ -218,7 +221,7 @@ void EDVDevicesListLoadFromSystem(
 	gulong file_size;
 	gint dev_num;
 	edv_device_struct *dev;
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	struct fstab *fs_ptr;
 #elif defined(__SOLARIS__)
 	struct vfstab *vfs_ptr;
@@ -232,7 +235,7 @@ void EDVDevicesListLoadFromSystem(
 	    return;
 
 	/* Open the system's devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	setfsent();
 	fp = FOpen("/etc/fstab", "rb");
 #elif defined(__SOLARIS__)
@@ -254,7 +257,7 @@ void EDVDevicesListLoadFromSystem(
 	    progress_cb(client_data, 0l, file_size);
 
 	/* Begin reading the system's devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	fs_ptr = getfsent();
 	while(fs_ptr != NULL)
 #elif defined(__SOLARIS__)
@@ -281,7 +284,7 @@ void EDVDevicesListLoadFromSystem(
 	    dev = EDVDevicesListMatchDevicePath(
 		*list, *total,
 		&dev_num,
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		fs_ptr->fs_spec
 #elif defined(__SOLARIS__)
 		vfs_ptr->vfs_special
@@ -309,7 +312,7 @@ void EDVDevicesListLoadFromSystem(
 		else
 		{
 		    (*list)[dev_num] = dev = EDVDeviceNew(
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 			EDVDeviceGetFSTypeFromName(fs_ptr->fs_vfstype),
 			NULL,
 			fs_ptr->fs_spec,
@@ -365,7 +368,7 @@ void EDVDevicesListLoadFromSystem(
 		    dev->command_check = g_strdup_printf(
 			"%s %s",
 			EDV_DEF_FSCK_FRONT_PROG,
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 			fs_ptr->fs_spec
 #elif defined(__SOLARIS__)
 			vfs_ptr->vfs_special
@@ -379,7 +382,7 @@ void EDVDevicesListLoadFromSystem(
 		    dev->command_format = g_strdup_printf(
 			"%s %s",
 			EDV_DEF_FORMAT_FRONT_PROG,
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 			fs_ptr->fs_spec
 #elif defined(__SOLARIS__)
 			vfs_ptr->vfs_special
@@ -398,7 +401,7 @@ void EDVDevicesListLoadFromSystem(
 
 		/* File system type */
 		dev->fs_type = EDVDeviceGetFSTypeFromName(
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		    fs_ptr->fs_vfstype
 #elif defined(__SOLARIS__)
 		    vfs_ptr->vfs_fstype
@@ -408,7 +411,7 @@ void EDVDevicesListLoadFromSystem(
 		);
 
 		/* Mount path */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		if(fs_ptr->fs_file != NULL)
 #elif defined(__SOLARIS__)
 		if(vfs_ptr->vfs_mountp != NULL)
@@ -417,7 +420,7 @@ void EDVDevicesListLoadFromSystem(
 #endif
 		{
 		    g_free(dev->mount_path);
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		    dev->mount_path = STRDUP(fs_ptr->fs_file);
 #elif defined(__SOLARIS__)
 		    dev->mount_path = STRDUP(vfs_ptr->vfs_mountp);
@@ -429,7 +432,7 @@ void EDVDevicesListLoadFromSystem(
 	    }
 
 	    /* Get the next mount entry */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	    fs_ptr = getfsent();
 #elif defined(__SOLARIS__)
 	    mtback = getmntent(fp, vfs_ptr);
@@ -440,7 +443,7 @@ void EDVDevicesListLoadFromSystem(
 
 
 	/* Close the system's devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	endfsent();
 	FClose(fp);
 #elif defined(__SOLARIS__)
@@ -497,7 +500,7 @@ void EDVDevicesListUpdateStats(
 {
 	gint i;
 	edv_device_struct *dev;
-#if defined(__SOLARIS__)
+#if defined(__SOLARIS__)||defined(__NetBSD__)
 	struct statvfs buf;
 #else
 	struct statfs buf;
@@ -519,7 +522,7 @@ void EDVDevicesListUpdateStats(
 	    if(EDV_DEVICE_IS_MOUNTED(dev))
 	    {
 		const gchar *mount_path = dev->mount_path;
-#if defined(__SOLARIS__)
+#if defined(__SOLARIS__)||defined(__NetBSD__)
 		if(!STRISEMPTY(mount_path) ?
 		    !statvfs(mount_path, &buf) : FALSE
 		)
