$NetBSD$

--- endeavour2/edv_device.c.orig	2008-02-02 17:00:00.000000000 -0500
+++ endeavour2/edv_device.c
@@ -1,5 +1,6 @@
 #include <stdio.h>
 #include <stdlib.h>
+#include <stdio.h>
 #include <string.h>
 #if defined(__FreeBSD__)
 # include <fstab.h>
@@ -10,6 +11,8 @@
 # include <sys/vfs.h>
 # include <sys/mnttab.h>
 # include <sys/statvfs.h>
+#elif defined(__NetBSD__)
+# include <sys/statvfs.h>
 #else
 # include <mntent.h>
 #endif
@@ -76,6 +79,9 @@ void EDVDeviceUpdateMountStateFromSystem
 #if defined(__FreeBSD__)
 	gint i, mntsize;
 	struct statfs *mt_buf;
+#elif defined(__NetBSD__)
+	gint i, mntsize;
+	struct statvfs *mt_buf;
 #elif defined(__SOLARIS__)
 	gint mtback;
 	struct mnttab *mt_ptr;
@@ -92,7 +98,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	d->flags &= ~EDV_DEVICE_MOUNTED;
 
 	/* Open the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	fp = (FILE *)1;		/* Mark the mount info file as opened */
 #elif defined(__SOLARIS__)
 	fp = fopen("/etc/mnttab", "rb");
@@ -103,7 +109,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	    return;
 
 	/* Begin reading the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	if((mntsize = getmntinfo(&mt_buf, MNT_NOWAIT)) == 0)
 	    return;
 	i = mntsize - 1;
@@ -121,7 +127,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	     * Device's device path
 	     */
 	    device_path = (const gchar *)(
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		mt_buf[i].f_mntfromname
 #elif defined(__SOLARIS__)
 		mt_ptr->mnt_special
@@ -146,7 +152,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	     * this Device's mounted path
 	     */
 	    mount_path = (const gchar *)(
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		mt_buf[i].f_mntonname
 #elif defined(__SOLARIS__)
 		mt_ptr->mnt_mountp
@@ -168,7 +174,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	    }
 
 	    /* Get the next mount entry */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	    i--;
 #elif defined(__SOLARIS__)
 	    mtback = getmntent(fp, mt_ptr);
@@ -178,7 +184,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	}
 
 	/* Close the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	fp = NULL;	/* Mark the mount info file as closed */
 #elif defined(__SOLARIS__)
 	fclose(fp);
