$NetBSD$

--- endeavour2/edv_device.c.orig	2006-07-01 20:44:00.000000000 -0400
+++ endeavour2/edv_device.c
@@ -1,4 +1,5 @@
 #include <stdlib.h>
+#include <stdio.h>
 #include <string.h>
 #if defined(__FreeBSD__)
 # include <fstab.h>
@@ -9,6 +10,8 @@
 # include <sys/vfs.h>
 # include <sys/mnttab.h>
 # include <sys/statvfs.h>
+#elif defined(__NetBSD__)
+# include <sys/statvfs.h>
 #else
 # include <mntent.h>
 #endif
@@ -205,6 +208,9 @@ void EDVDeviceUpdateMountStateFromSystem
 #if defined(__FreeBSD__)
 	gint i, mntsize;
 	struct statfs *mt_buf;
+#elif defined(__NetBSD__)
+	gint i, mntsize;
+	struct statvfs *mt_buf;
 #elif defined(__SOLARIS__)
 	gint mtback;
 	struct mnttab *mt_ptr;
@@ -222,7 +228,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	    return;
 
 	/* Open the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	fp = (FILE *)1;		/* Mark the mount info file as opened */
 #elif defined(__SOLARIS__)
 	fp = FOpen("/etc/mnttab", "rb");
@@ -233,7 +239,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	    return;
 
 	/* Begin reading the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	if((mntsize = getmntinfo(&mt_buf, MNT_NOWAIT)) == 0)
 	    return;
 	i = mntsize - 1;
@@ -251,7 +257,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	     * Device's device path
 	     */
 	    device_path = (const gchar *)(
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		mt_buf[i].f_mntfromname
 #elif defined(__SOLARIS__)
 		mt_ptr->mnt_special
@@ -273,7 +279,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	     * this Device's mounted path
 	     */
 	    mount_path = (const gchar *)(
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 		mt_buf[i].f_mntonname
 #elif defined(__SOLARIS__)
 		mt_ptr->mnt_mountp
@@ -292,7 +298,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	    }
 
 	    /* Get the next mount entry */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	    i--;
 #elif defined(__SOLARIS__)
 	    mtback = getmntent(fp, mt_ptr);
@@ -302,7 +308,7 @@ void EDVDeviceUpdateMountStateFromSystem
 	}
 
 	/* Close the system's mounted devices list file */
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__)||defined(__NetBSD__)
 	fp = NULL;	/* Mark the mount info file as closed */
 #elif defined(__SOLARIS__)
 	FClose(fp);
