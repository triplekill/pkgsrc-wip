$NetBSD$

--- src/core/k3bglobals.cpp.orig	2005-05-11 01:57:25.000000000 -0700
+++ src/core/k3bglobals.cpp	2005-08-04 16:51:17.000000000 -0700
@@ -34,16 +34,19 @@
 
 #include <cmath>
 #include <sys/utsname.h>
-
-#ifdef __FreeBSD__
-#include <sys/param.h>
-#include <sys/mount.h>
+#include <config.h>
+#if defined(__FreeBSD__) || defined(__NetBSD__)
+  #include <sys/param.h>
+  #include <sys/mount.h>
 #else
-#include <sys/vfs.h>
+  #ifdef HAVE_SYS_STATVFS_H
+    #include <sys/statvfs.h>
+  #endif
+  #ifdef HAVE_SYS_STATFS_H
+    #include <sys/vfs.h>
+  #endif
 #endif
 
-
-
 struct Sample {
   unsigned char msbLeft;
   unsigned char lsbLeft;
@@ -217,9 +220,17 @@
 
 bool K3b::kbFreeOnFs( const QString& path, unsigned long& size, unsigned long& avail )
 {
+#ifdef HAVE_STATVFS
+  struct statvfs fs;
+  if( ::statvfs( QFile::encodeName(path), &fs ) == 0 ) {
+#else
+  #ifndef HAVE_STATFS
+    #error "No statfs, no statvfs? Help!"
+  #endif
   struct statfs fs;
 
   if( ::statfs( QFile::encodeName(path), &fs ) == 0 ) {
+#endif
     unsigned long kBfak = fs.f_bsize/1024;
 
     size = fs.f_blocks*kBfak;
