$NetBSD: patch-ao,v 1.2 2009/10/18 22:22:10 ahoka Exp $

NOTE:	When updating this, make sure it harmonizes with
	multimedia/ffmpeg/patches/patch-oldx264.

--- libavcodec/libx264.c.orig	2010-02-24 22:40:10.000000000 +0000
+++ libavcodec/libx264.c
@@ -214,7 +214,11 @@ static av_cold int X264_init(AVCodecCont
 
     x4->params.i_bframe          = avctx->max_b_frames;
     x4->params.b_cabac           = avctx->coder_type == FF_CODER_TYPE_AC;
+#if X264_BUILD > 62
     x4->params.i_bframe_adaptive = avctx->b_frame_strategy;
+#else
+    x4->params.b_bframe_adaptive = avctx->b_frame_strategy;
+#endif
     x4->params.i_bframe_bias     = avctx->bframebias;
 #if X264_BUILD >= 78
     x4->params.i_bframe_pyramid  = avctx->flags2 & CODEC_FLAG2_BPYRAMID ? X264_B_PYRAMID_NORMAL : X264_B_PYRAMID_NONE;
@@ -288,6 +292,10 @@ static av_cold int X264_init(AVCodecCont
     x4->params.analyse.i_me_range         = avctx->me_range;
     x4->params.analyse.i_subpel_refine    = avctx->me_subpel_quality;
 
+#if X264_BUILD < 65
+    x4->params.analyse.b_bidir_me = (avctx->bidir_refine > 0);
+    x4->params.analyse.b_bframe_rdo = (avctx->flags2 & CODEC_FLAG2_BRDO);
+#endif
     x4->params.analyse.b_mixed_references = avctx->flags2 & CODEC_FLAG2_MIXED_REFS;
     x4->params.analyse.b_chroma_me        = avctx->me_cmp & FF_CMP_CHROMA;
     x4->params.analyse.b_transform_8x8    = avctx->flags2 & CODEC_FLAG2_8X8DCT;
@@ -316,6 +324,10 @@ static av_cold int X264_init(AVCodecCont
     x4->params.rc.f_pb_factor             = avctx->b_quant_factor;
     x4->params.analyse.i_chroma_qp_offset = avctx->chromaoffset;
 
+#if X264_BUILD < 61
+    x4->params.rc.psz_rc_eq = avctx->rc_eq;
+#endif
+
     x4->params.analyse.b_psnr = avctx->flags & CODEC_FLAG_PSNR;
     x4->params.i_log_level    = X264_LOG_DEBUG;
 
