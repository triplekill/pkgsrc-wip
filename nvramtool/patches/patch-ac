$NetBSD$

--- cmos_lowlevel.c.orig	2010-02-05 20:29:37.000000000 +0000
+++ cmos_lowlevel.c
@@ -33,6 +33,11 @@
 #include <unistd.h>
 #endif
 
+#if defined(__NetBSD__)
+#include <sys/types.h>
+#include <machine/sysarch.h>
+#endif
+
 #include "common.h"
 #include "cmos_lowlevel.h"
 
@@ -289,6 +294,18 @@ void set_iopl(int level)
 			}
 		}
 	}
+#elif defined(__NetBSD__)
+	errno = 0;
+#if defined(__i386__)
+	if (i386_iopl(level)) 
+#elif defined(__x86_64__)
+	if (x86_64_iopl(level))
+#endif  
+	{
+		fprintf(stderr, "%s: (i386|x86_64)_iopl() failed: %s\n",
+		    prog_name, strerror(errno));
+		exit(1);
+	}
 #else
 	if (iopl(level)) {
 		fprintf(stderr, "%s: iopl() system call failed.  "
