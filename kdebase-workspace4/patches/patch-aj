$NetBSD$

--- plasma/plasma/plasmaapp.cpp.orig	2008-01-05 12:55:50.000000000 +1300
+++ plasma/plasma/plasmaapp.cpp
@@ -46,6 +46,11 @@
 #include "desktopview.h"
 #include "panelview.h"
 
+#ifndef _SC_PHYS_PAGES
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#endif
+
 #include <X11/Xlib.h>
 #include <X11/extensions/Xrender.h>
 
@@ -139,8 +144,18 @@ PlasmaApp::PlasmaApp(Display* display, Q
     cacheSize += cacheSize / 10;
 
     // Calculate the size of physical system memory
+#ifdef _SC_PHYS_PAGES
     int memorySize = sysconf(_SC_PHYS_PAGES);
     memorySize *= sysconf(_SC_PAGESIZE) / 1024;
+#else
+    size_t memorySize;
+    size_t len;
+    static int mib[]={ CTL_HW, HW_PHYSMEM };
+
+    len = sizeof(memorySize);
+    sysctl(mib, 2, &memorySize, &len, NULL, 0);
+    memorySize /= 1024;
+#endif
 
     // Increase the pixmap cache size to 1% of system memory if it isn't already
     // larger so as to maximize cache usage. 1% of 1GB ~= 10MB.
