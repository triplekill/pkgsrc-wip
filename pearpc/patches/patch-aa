$NetBSD$

--- src/io/3c90x/if_posix.cc.orig	2004-05-22 03:17:00.000000000 +0200
+++ src/io/3c90x/if_posix.cc	2004-05-22 03:41:04.000000000 +0200
@@ -24,12 +24,19 @@
 #else
 
 #include <sys/ioctl.h>
-#include <asm/types.h>
 #include <sys/socket.h>
 #include <sys/wait.h>
+#ifdef __linux__
+#define TUN_DEVICE "/dev/net/tun"
+#include <asm/types.h>
 #include <linux/netlink.h>
 #include <linux/if.h>
 #include <linux/if_tun.h>
+#elif defined(__NetBSD__)
+#define TUN_DEVICE "/dev/tun"
+#include <net/if.h>
+#include <net/if_tun.h>
+#endif
 
 #include <sys/types.h>
 #include <sys/stat.h>
@@ -106,6 +113,7 @@
 /************************************************************************/
 
 #define TAP_PACKET_PAD			2		/* used by read & writes */
+#ifdef HAS_TAP
 
 static int tap_open(enet_iface_t *is, char *intf_name, int *sigio_capable, byte mac[6])
 {
@@ -165,6 +173,8 @@
 	close:			generic_close,
 };
 
+#endif /* !HAS_TAP */
+
 /************************************************************************/
 /*	TUN/TAP Packet Driver						*/
 /************************************************************************/
@@ -209,21 +219,28 @@
 	int fd;
 
 	/* allocate tun/tap device */ 
-	if ((fd = open("/dev/net/tun", O_RDWR)) < 0) {
-		perrorm("Failed to open /dev/net/tun");
+	if ((fd = open(TUN_DEVICE, O_RDWR)) < 0) {
+		perrorm("Failed to open TUN_DEVICE");
 		return 1;
 	}
 	memset(&ifr, 0, sizeof(ifr));
+#ifndef __NetBSD__
 	ifr.ifr_flags = IFF_TAP | IFF_NO_PI;
-
+#endif
 	strncpy(ifr.ifr_name, intf_name, IFNAMSIZ);
+#ifdef __NetBSD__
+	if (ioctl(fd, TUNSIFMODE, &ifr) < 0) {
+#else
 	if (ioctl(fd, TUNSETIFF, &ifr) < 0) {
+#endif
 		perrorm("TUNSETIFF");
 		goto out;
 	}
 
+#ifndef __NetBSD__
 	/* don't checksum */
 	ioctl(fd, TUNSETNOCSUM, 1);
+#endif
 
 	/* Configure device */
 //	script_exec(get_filename_res(TUNSETUP_RES), intf_name, "up");
