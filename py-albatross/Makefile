# $NetBSD$
#

DISTNAME=	albatross-1.10pre2
PKGNAME=	${PYPKGPREFIX}-${DISTNAME}
CATEGORIES=	www python
MASTER_SITES=	http://www.object-craft.com.au/projects/albatross/download/

MAINTAINER=	marc@informatik.uni-bremen.de
HOMEPAGE=	http://www.object-craft.com.au/projects/albatross/
COMMENT=	Toolkit for Stateful Web Applications

PYDISTUTILSPKG=	yes
PY_PATCHPLIST=	yes
USE_BUILDLINK2=	yes

RUNTIME_DIR?=	/var/run/albatross
LOGDIR?=	/var/log/albatross
EXAMPLEDIR=	${PREFIX}/share/examples/albatross
LOGFILE?=	${LOGDIR}/al-session-daemon.log
PIDFILE?=	${RUNTIME_DIR}/session-daemon.pid

ALBATROSS_USER=	albatross
ALBATROSS_GROUP=albatross

FILES_SUBST+=	ALBATROSS_USER=${ALBATROSS_USER}
FILES_SUBST+=	ALBATROSS_GROUP=${ALBATROSS_GROUP}
FILES_SUBST+=	RUNTIME_DIR=${RUNTIME_DIR}
FILES_SUBST+=	LOGFILE=${LOGFILE}
FILES_SUBST+=	PIDFILE=${PIDFILE}

RCD_SCRIPTS=	al_session_daemon
PKG_GROUPS=	${ALBATROSS_USER}
PKG_USERS=	${ALBATROSS_USER}:${ALBATROSS_GROUP}

OWN_DIRS=	${RUNTIME_DIR}
OWN_DIRS+=	${LOGDIR}
OWN_DIRS_PERMS=	${RUNTIME_DIR} ${ALBATROSS_USER} ${ALBATROSS_GROUP} 0750
OWN_DIRS_PERMS+=${LOGDIR} ${ALBATROSS_USER} ${ALBATROSS_GROUP} 0750

PYTHON_PATCH_SCRIPTS=	samples/extension/cal.py
PYTHON_PATCH_SCRIPTS+=	samples/form4/form.py
PYTHON_PATCH_SCRIPTS+=	samples/paginate/paginate.py
PYTHON_PATCH_SCRIPTS+=	samples/popview1/popview.py
PYTHON_PATCH_SCRIPTS+=	samples/popview2/popview.py
PYTHON_PATCH_SCRIPTS+=	samples/popview3/popview.py
PYTHON_PATCH_SCRIPTS+=	samples/popview4/popview.py
PYTHON_PATCH_SCRIPTS+=	samples/random/random.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/content1/content.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/content2/content.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/form1/form.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/form2/form.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/form3/form.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/simple1/simple.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/simple2/simple.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/simple3/simple.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/simple4/simple.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/simple5/simple.py
PYTHON_PATCH_SCRIPTS+=	samples/templates/stream/stream.py
PYTHON_PATCH_SCRIPTS+=	samples/tree1/tree.py
PYTHON_PATCH_SCRIPTS+=	samples/tree2/tree.py
PYTHON_PATCH_SCRIPTS+=	samples/tree3/tree.py

# XXX chmod/chown shouldn't be there OWN_DIRS* should handle this
post-install:
	${INSTALL_DATA_DIR} ${EXAMPLEDIR}
	cd ${WRKSRC}/samples && ${FIND} . -type f \! -name \.cvsignore \
		-print | ${PAX} -rw -pp -pm ${EXAMPLEDIR}
	${PYTHONBIN} -O ${PREFIX}/${PYLIB}/compileall.py \
		${PREFIX}/${PYSITELIB}/albatross
	${CHMOD} 0750 ${RUNTIME_DIR} ${LOGDIR}
	${CHOWN} ${PKG_USERS} ${RUNTIME_DIR} ${LOGDIR}

.include "../../lang/python/application.mk"
.include "../../lang/python/extension.mk"

.include "../../mk/bsd.pkg.install.mk"
.include "../../mk/bsd.pkg.mk"
