#!/bin/sh
# Run XFree86 with an older version of the proprietary AMD/ATI Linux
# drivers so as to properly initialize some ATI card variants.
#
# Unfortunately -probeonly doesn't seem to be sufficient, so we
# need to actually start the server, and then send SIGTERM to cause
# it to quit.

# We could just use the existing XF86Config and explicitly specify
#    -modulepaths "@INITATIDIR@/,..."
# but figuring out the other paths seems difficult.  And this way
# we control what other extensions are loaded.
XFree86 -xf86config @INITATIDIR@/XF86Config.initati \
    -nolisten tcp -nolisten inet6 \
    "$@" &

pid=$!
sleep 5
kill $pid

# this was necessary once or twice
if [ -t 1 ]; then
    stty sane
fi
