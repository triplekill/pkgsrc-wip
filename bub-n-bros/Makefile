# $NetBSD$
#

DISTNAME=		bub-n-bros-1.1
PKGREVISION=		1
CATEGORIES=		games
MASTER_SITES=		${MASTER_SITE_SOURCEFORGE:=bub-n-bros/}

MAINTAINER=		recht@NetBSD.org
HOMEPAGE=		http://bub-n-bros.sourceforge.net/
COMMENT=		Multiplayer crazy clone of Bubble Bobble

WRKSRC=			${WRKDIR}/bub-n-bros
PY_PATCHPLIST=		yes

MAKE_ENV+=		CFLAGS=${CFLAGS:M*:Q}
MAKE_ENV+=		LDFLAGS=${LDFLAGS:M*:Q}

PYTHON_VERSIONS_ACCEPTED= 23 22 

PYTHON_PATCH_SCRIPTS=	pclient-pygame.py
PYTHON_PATCH_SCRIPTS+=	pclient-slow-X.py
PYTHON_PATCH_SCRIPTS+=	pclient-xshm.py
PYTHON_PATCH_SCRIPTS+=	bubbob/bb.py
PYTHON_PATCH_SCRIPTS+=	bubbob/doc/bonus-doc.py
PYTHON_PATCH_SCRIPTS+=	display/pclient.py
PYTHON_PATCH_SCRIPTS+=	display/playback.py

PAX_SUBST=	-s ',*/setup.py,,' -s ',*/setup.py.pre,,'

post-patch:
	${MV} ${WRKSRC}/display/setup.py ${WRKSRC}/display/setup.py.pre
	${SED}  -e "s,@X11BASE@,${X11BASE},g" \
		${WRKSRC}/display/setup.py.pre > ${WRKSRC}/display/setup.py
do-build:
	cd ${WRKSRC}/display && \
		${SETENV} ${MAKE_ENV} ${PYTHONBIN} setup.py build_ext -i
	cd ${WRKSRC}/bubbob && \
		${SETENV} ${MAKE_ENV} ${PYTHONBIN} setup.py build_ext -i
	cd ${WRKSRC}/display && ${PYTHONBIN} setup.py clean
	cd ${WRKSRC}/bubbob && ${PYTHONBIN} setup.py clean
	${PYTHONBIN} -O ${PREFIX}/${PYLIB}/compileall.py ${WRKSRC}

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/games/${PKGBASE}
	cd ${WRKSRC} && ${PAX} ${PAX_SUBST} \
		-rwpe . ${PREFIX}/games/${PKGBASE}

.include "../../lang/python/application.mk"
.include "../../devel/py-game/buildlink3.mk"

.include "../../mk/x11.buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
